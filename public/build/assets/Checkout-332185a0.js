import{j as n,a as e,Y as P,q as L,W as M,r as d,c as T}from"./app-a1ac7c39.js";import{A as U,u as J}from"./AppLayout-9ada778d.js";import"./ApplicationLogo-5b869f1b.js";import"./NavLink-1614efb6.js";function K(){var S,D;const{flash:b}=L().props,{cart:l,removeFromCart:g,apply_coupon:j}=J()??{},{post:E,data:s,reset:Y,setData:x,errors:t,clearErrors:A,processing:B}=M({name:"",email:"",address:"",division:"",mobile:"",notes:"",payment_method:"cash_on_delivery",payment_status:"pending",shipping_cost:0})??{},y=new URLSearchParams(window.location.search),[f,m]=d.useState(),[N,v]=d.useState(""),[_,w]=d.useState("");d.useEffect(()=>{b.error&&m(b.error)},[b]),d.useEffect(()=>{const a=y.get("paymentID"),c=y.get("status");if(a)switch(c){case"cancel":m("The payment was cancelled.");break;case"failure":m("The payment was failed.");break;case"success":x("payment_status","paid"),k()}},[]),d.useEffect(()=>{if(f){const a=setTimeout(()=>{window.history.replaceState(null,"",window.location.pathname),m("")},5e3);return()=>clearTimeout(a)}},[]);const p=a=>{const{name:c,value:i}=a.target;x(c,i)},q=a=>{m(""),a.preventDefault(),s.payment_method==="bkash"?R():k()};function R(){T.post(route("home.online_payment"),{total_amount:parseInt(l.total_amount)+parseInt(s.shipping_cost)}).then(a=>{window.location.href=a.data.bkashURL}).catch(a=>{m(a.response.data.message)})}function k(){fbq("track","Purchase",{value:l.total_amount+parseInt(s.shipping_cost),currency:"BDT",content_ids:l.cart_items.map(a=>a.product.id),content_type:"product"}),E(route("home.place_order"),{onSuccess:()=>{A()}})}const C=d.useRef(null),O=async()=>{var a,c,i,u,r,h,I;v(""),w("");try{const o=await T.post(route("home.apply_coupon"),{coupon_code:((a=C.current)==null?void 0:a.value)??""});(o==null?void 0:o.status)===200&&(w(((c=o.data)==null?void 0:c.message)??""),j(((i=o.data)==null?void 0:i.coupon_id)??"",((u=o.data)==null?void 0:u.discount)??0,((r=o.data)==null?void 0:r.coupon)??""))}catch(o){v(((I=(h=o==null?void 0:o.response)==null?void 0:h.data)==null?void 0:I.message)??"An unexpected error occurred")}};return n("form",{className:"container gap-4 mx-auto lg:flex",onSubmit:q,children:[n("div",{className:"p-4 md:p-8 mb-8 bg-white rounded-lg shadow-lg lg:flex-grow",children:[e("h1",{className:"mb-6 text-2xl font-bold",children:"Billing details"}),f&&e("p",{className:"mb-6 text-center text-red-500 text-wrap",children:f}),n("div",{className:"grid gap-6",children:[n("div",{className:"col-span-2 md:col-span-1",children:[e("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"Name / আপনার নাম *"}),e("input",{type:"text",name:"name",value:(s==null?void 0:s.name)??"",onChange:p,className:"w-full p-2 border rounded-lg",required:!0}),(t==null?void 0:t.name)&&e("p",{className:"text-red-500",children:t.name})]}),n("div",{className:"col-span-2 md:col-span-1",children:[e("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"Email / আপনার ইমেইল"}),e("input",{type:"email",name:"email",value:(s==null?void 0:s.email)??"",onChange:p,className:"w-full p-2 border rounded-lg"}),(t==null?void 0:t.email)&&e("p",{className:"text-red-500",children:t.email})]}),n("div",{className:"col-span-2 md:col-span-1",children:[e("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"Division / বিভাগ *"}),n("select",{name:"division",value:(s==null?void 0:s.division)??"",onChange:p,className:"w-full p-2 border rounded-lg",required:!0,children:[e("option",{value:"",children:"Select a Division"}),e("option",{value:"Dhaka",children:"Dhaka"}),e("option",{value:"Chittagong",children:"Chittagong"}),e("option",{value:"Rajshahi",children:"Rajshahi"}),e("option",{value:"Khulna",children:"Khulna"}),e("option",{value:"Barisal",children:"Barisal"}),e("option",{value:"Sylhet",children:"Sylhet"}),e("option",{value:"Rangpur",children:"Rangpur"}),e("option",{value:"Mymensingh",children:"Mymensingh"})]}),(t==null?void 0:t.division)&&e("p",{className:"text-red-500",children:t.division})]}),n("div",{className:"col-span-2 md:col-span-1",children:[e("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"Mobile Number *"}),e("input",{type:"number",name:"mobile",value:(s==null?void 0:s.mobile)??"",onChange:p,className:"w-full p-2 border rounded-lg",required:!0}),(t==null?void 0:t.mobile)&&e("p",{className:"text-red-500",children:t.mobile})]}),n("div",{className:"col-span-2",children:[e("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"Full Address / বিস্তারিত ঠিকানা *"}),e("input",{type:"text",name:"address",value:(s==null?void 0:s.address)??"",onChange:p,className:"w-full p-2 border rounded-lg",required:!0}),(t==null?void 0:t.address)&&e("p",{className:"text-red-500",children:t.address})]}),n("div",{className:"col-span-2",children:[e("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"Order notes (optional)"}),e("textarea",{name:"notes",value:(s==null?void 0:s.notes)??"",onChange:p,className:"w-full p-2 border rounded-lg",rows:3}),(t==null?void 0:t.notes)&&e("p",{className:"text-red-500",children:t.notes})]})]}),(t==null?void 0:t.orderItems)&&e("div",{className:"text-center text-red-500",children:t.orderItems})]}),n("div",{className:"p-4 md:p-8 mb-8 bg-white rounded-lg shadow-lg lg:w-1/3",children:[e("h2",{className:"mb-6 text-2xl font-bold",children:"Your order"}),e("div",{className:"space-y-4",children:(S=l==null?void 0:l.cart_items)==null?void 0:S.map((a,c)=>{var i,u;return n("div",{className:"p-4 border rounded-lg shadow-sm",children:[n("div",{className:"flex justify-between items-start",children:[n("div",{className:"flex items-start gap-2",children:[e("button",{type:"button",onClick:()=>g==null?void 0:g(a.id),className:"text-red-500 hover:text-red-700",children:"✕"}),n("div",{children:[e("span",{className:"block font-medium",children:((i=a==null?void 0:a.product)==null?void 0:i.name)??"Unnamed product"}),n("span",{className:"block text-sm text-gray-500",children:["x ",(a==null?void 0:a.quantity)??1]})]})]}),n("div",{className:"text-red-500 font-semibold",children:[(a==null?void 0:a.subtotal)??0," BDT"]})]}),(a==null?void 0:a.variants)&&Array.isArray(JSON.parse(a.variants))&&e("div",{className:"mt-2 text-sm text-gray-700",children:(u=JSON.parse(a.variants))==null?void 0:u.map((r,h)=>(r==null?void 0:r.values)&&e("span",{className:"block",children:r==null?void 0:r.values},h))})]},c)})}),n("div",{className:"flex mt-8",children:[e("input",{type:"text",placeholder:"Coupon code",className:"flex-1 p-2 mr-2 border rounded",ref:C}),e("button",{type:"button",onClick:O,className:"p-2 text-white bg-indigo-500 rounded hover:bg-indigo-700 text-sm",children:"Apply Coupon"})]}),N&&e("p",{className:"mt-4 text-center text-red-500",children:N}),_&&e("p",{className:"mt-4 text-center text-green-500",children:_}),n("div",{className:"flex justify-between w-full mt-8",children:[e("h3",{children:"Shipping cost:"}),n("span",{children:[s.shipping_cost," BDT"]})]}),(l.coupon||l.cart_items.some(a=>a.coupon))&&n("div",{className:"flex justify-between my-4",children:[e("span",{className:"font-semibold",children:"Applied coupon"}),n("span",{className:"font-bold text-red-500",children:[l.cart_items.some(a=>a.coupon)?l.cart_items.reduce((a,c)=>{var i;return a+parseInt(((i=c.coupon)==null?void 0:i.value)||0)},0):(D=l.coupon)==null?void 0:D.value," BDT"]})]}),n("div",{className:"",children:[e("h3",{className:"text-xl font-bold",children:"Payment method:"}),n("div",{children:[e("input",{type:"radio",id:"cash_on_delivery",name:"payment_method",value:"cash_on_delivery",checked:(s==null?void 0:s.payment_method)==="cash_on_delivery",onChange:a=>x("payment_method",a.target.value)}),e("label",{htmlFor:"cash_on_delivery",className:"ml-2",children:"Cash on Delivery"}),e("br",{})]})]}),n("div",{className:"flex justify-between w-full mt-8",children:[e("h3",{children:"Total:"}),n("span",{children:[parseInt(l==null?void 0:l.total_amount)+parseInt(s.shipping_cost)||0," BDT"]})]}),e("button",{type:"submit",className:"w-full p-2 mt-8 text-white bg-indigo-500 rounded hover:bg-indigo-700",children:B?e("i",{className:"self-center mb-3 text-2xl fa fa-spinner animate-spin"}):"Place Order"})]})]})}function H(){return n(U,{children:[e(P,{title:"Checkout"}),e(K,{})]})}export{H as default};
